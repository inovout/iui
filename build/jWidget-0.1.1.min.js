var Inovout={};
Inovout.Element=Class.create({initialize:function(b){var a=this;this.dom=b;this.dom.uid=(new Date).getTime()+""+parseInt(1E5*Math.random(),10);this.eventHnadles={};this.eventCallbacks={};Inovout.Element.eventNames.each(function(b){var d=a[b]=new Event(b,a);d._addListener=d.addListener;d.addListener=function(e,l,f){d.hasListeners()||a.bind(b,function(b){d.fire(a,{target:Inovout.Element.get(b.target)})});d._addListener(e,l,f)}})},complete:function(b,a){var c=Object.isString(b)?b:b.name,d,e=this;if(!(d=
this.eventCallbacks[c])){d=this.eventCallbacks[c]=$.Callbacks();var l=jQuery._data(e.dom);e.eventHnadles[c]=l.handle||$.event.dispatch;e.removeEventtLister(c,e.eventHnadles[c]);e.addEventLister(c,function(a){var b=e.eventHnadles[c].apply(e.dom,arguments);d.fire(a);return b})}d.add(a)},addEventLister:function(b,a){var c=this.dom;c.addEventListener?c.addEventListener(b,a,!1):c.attachEvent&&c.attachEvent("on"+b,a)},removeEventtLister:function(b,a){var c=this.dom;if(c.removeEventListener)c.removeEventListener(b,
a,!1);else if(c.detachEvent){var d="on"+b;typeof c[d]===core_strundefined&&(c[d]=null);c.detachEvent(d,a)}},getClassName:function(){return this.dom.className},equals:function(b){return this.dom&&b.dom&&this.dom==b.dom},getAttributes:function(){return this.dom.attributes},toString:function(){return this.dom.uid}});
Object.extend(Inovout.Element,{cache:new HashMap,get:function(b){if("string"==typeof b)b=document.getElementById(b);else if(b instanceof Inovout.Element)return b;var a=Inovout.Element.cache.get(b);a||(a=new Inovout.Element(b),Inovout.Element.cache.add(b,a));return a},eventNames:"blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" ")});
Inovout.Element.prototype._initialize=Inovout.Element.prototype.initialize;Inovout.Element.prototype.initialize=function(b){Object.extend(this,jQuery.fn);this.init(b);var a=this;["find"].each(function(b){a["_"+b]=a[b];a[b]=function(){var d=a["_"+b].apply(a,arguments);return jQuery.map(d,function(a){return Inovout.Element.get(a)})}});Inovout.Element.prototype._initialize.call(this,b)};Inovout.HAML={};
Inovout.HAML.EventAdapter=Class.create({initialize:function(b,a){this.event=b;this.buildFunction=a=a||Function.build;return this},listen:function(b,a){this.buildFunction("sender,args",this.fnExpression).call(this.scope,b,a)},addListener:function(b,a,c){this.fnExpression=b;this.scope=a;this.event.addListener(this.listen,this,c)}});Inovout.HAML.Parsers={};
Inovout.HAML.Parsers.EventAdapterParser={parse:function(b){b.find("[data-event-adapter]").each(function(a){a.attr("data-event-adapter").split(";").each(function(b){if(""!=b){b=b.split("=");var d=b[0].split("."),d=Inovout.View.get(d[0])[d[1]],d=new Inovout.HAML.EventAdapter(d),e=Inovout.View.get(a);d.addListener(b[1],e)}})})}};Inovout.HAML.Parser={parse:function(b){for(var a in Inovout.HAML.Parsers)Inovout.HAML.Parsers[a].parse(b)}};
Inovout.HAML.CommandBinder=Class.create(Inovout.HAML.EventAdapter,{initialize:function($super,a,c){$super(a,c);return this}});Inovout.HAML.Parsers.CommandBinderParser={parse:function(b){Inovout.Element.eventNames.each(function(a){b.find("[data-"+a+"-command]").each(function(b){var d=b.attr("data-"+a+"-command");(new Inovout.HAML.CommandBinder(b[a],Inovout.View.buildFunction)).addListener(d,b)})})}};
Inovout.HAML.EncryptInput=Class.create({initialize:function(b){var a=b.attr("name"),c=b.data("encrypt").split("|");b.removeAttr("name");var d=$("<input type='hidden' name="+a+" />");b.after(d);Inovout.Element.get(b.parents("form")).submit.addListener(function(a,l){var f=b.val(),k=new RSAKey;k.setPublic(c[0],c[1]);d.val(k.encrypt(f))});return this}});Inovout.HAML.Parsers.EncryptInputParser={parse:function(b){b.find("[data-encrypt]").each(function(b){new Inovout.HAML.EncryptInput(b)})}};
Inovout.Widgets={};Inovout.View=Class.create({initialize:function(b){this.element=Inovout.Element.get(b);return this}});
Object.extend(Inovout.View,{cache:new HashMap,tryGet:function(b){for(var a in Inovout.Widgets){var c=a.substring(0,1).toLowerCase()+a.substring(1,a.length);if(b.hasClass(c)||a.toLowerCase()==b.dom.tagName.toLowerCase())return a=new Inovout.Widgets[a](b),Inovout.View.cache.add(b,a),a}},get:function(b){if(b instanceof Inovout.View)return b;b=Inovout.Element.get(b);var a=Inovout.View.cache.get(b)||Inovout.View.tryGet(b);a||(a=new Inovout.View(b),Inovout.View.cache.add(b,a),Object.extend(a,b));return a},
buildFunction:function(b,a){a=a.trim();var c=a.indexOf("."),d=a.substring(0,c);return"this"!=d&&""!=d&&"page"!=d?(a="Inovout.View.get("+d+")."+a.substring(c+1,a.length),Function(b,a)):Function.build(b,a)}});
var Page=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.init=new Event("init",this);this.load=new Event("load",this);return this},run:function(){this.init.fire(this,this.wrapEventArgs(this));this.load.fire(this,this.wrapEventArgs(this));this.parseHAML(this.element)},wrapEventArgs:function(b){return{text:""}},parseHAML:function(b){b=Inovout.Element.get(b);Inovout.HAML.Parser.parse(b)},showDialog:function(b,a,c,d){b=new Uri(b);b.paras=[];b.add({_model:"dialog"});return this.frameDialog=
new Inovout.Widgets.Dialog(b.build(),a,c,d)},closeDialog:function(){return this.frameDialog.close()},postMessage:function(b){this.frameDialog.receiveMess(b)}}),DialogPage=Class.create(Page,{initialize:function($super,a){$super(a);return this},run:function($super){this.element.find("form").each(function(a){a.attr("data-async","page.submitCallBack(data)")});$super()},submitCallBack:function(b){window.parent.page.postMessage(b)},closeDialog:function(){window.parent.page.closeDialog()}});
if(!iui){var iui={};iui.ready=iui.ready||jQuery(window).ready}var page;iui.ready(function(){page=window===window.parent?new Page(document):-1!=window.location.href.indexOf("_model")?new DialogPage(document):new Page(document);page.init.addListener(function(){var b=Inovout.Element.get(document),a;for(a in Inovout.Widgets){var c=a.substring(0,1).toLowerCase()+a.substring(1,a.length);b.find("."+c+","+a).each(function(b){Inovout.View.get(b)})}});page.run()});
Inovout.Widgets.List=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.selectedChanged=new Event("selectedChanged",this);return this},bindData:function(b){Object.isJSON(b)?(element.empty(),$.each(b,function(b,c){this.add(c)})):$.getJSON(b).done(function(b){this.bindData(b)})},wrapEventArgs:function(b){var a={text:b.text()};Object.extend(a,b.data());a.value=a.value||b.val()||b.text();return a},valueKeys:void 0});
Inovout.Widgets.DropDownList=Class.create(Inovout.Widgets.List,{initialize:function($super,a){$super(a);var c=this;a.change.addListener(function(a,e){var l=c.element.children("option:selected")[0];c.selectedChanged.fire(c,c.wrapEventArgs(l))});return this},add:function(b){this.element.append('<option value="'+b.value+'">'+b.value+"</option>")}});
Inovout.Widgets.TabList=Class.create(Inovout.Widgets.List,{initialize:function($super,a){$super(a);this.selectedChanged=new Event("selectedChanged",this);var c=this;this.element.children().each(function(a){a.click.addListener(function(a,d){var f=c.element.find("li.selected")[0];if(!a.equals(f)){f.removeClass("selected");a.addClass("selected");f={text:a.text()};if(!c.valueKeys){c.valueKeys=[];for(var k=a.getAttributes(),g=0;g<k.length;g++){var h=k[g].name;-1<h.indexOf("data-")&&c.valueKeys.push(h.substring(5,
h.length))}}for(g=0;g<c.valueKeys.length;g++)f[c.valueKeys[g]]=a.attr("data-"+c.valueKeys[g]);f.value=f.value||a.text();c.selectedChanged.fire(c,f)}})});return this},valueKeys:void 0});
Inovout.Widgets.Form=Class.create(Inovout.View,{initialize:function($super,a){function c(c){var f=new Uri(a.prop("action")),e=a.serializeJSON(),g=new HttpRequest(a.prop("method"),f),h,m=new HttpClient;enctype=a.attr("enctype")||"application/x-www-form-urlencoded";if(0<f.uri.indexOf("["))for(name in e)f.uri=f.uri.replace(RegExp("\\["+name+"\\]","ig"),e[name]);"post"==g.method&&("application/x-www-form-urlencoded"==enctype?h=new JsonContent(e):"multipart/related"==enctype&&(f="iui_"+(""+Math.random()).replace(/\D/g,
""),h=new MultipartContent("related",f),h.add(new JsonContent(e)),a.find(".fileInput").each(function(a){h.add(new FileContent(Inovout.View.get(a.fileInput.files[0])))})),g.content=h);m.send(g).read().done(function(a){Inovout.View.buildFunction("data",c).call(d,a)})}$super(a);Object.extend(this,a);var d=this,e=a.data("async");e&&(a.complete(a.submit,function(a){a.defaultPrevented||(a.preventDefault(),a.stopPropagation(),c(e))}),a.find("input[type=file]").each(function(a){var c=$('<div class="fileInput"><button type="button" class="fileInput_browse_button">\u6d4f\u89c8</button></div>')[0];
a.replaceWith(c);Inovout.View.get(c)}));return this}});Inovout.Widgets.FileInput=Class.create(Inovout.View,{initialize:function($super,a){$super(a);var c=this,d={browse_button:a.find(".fileInput_browse_button")[0].dom,container:a.dom};a.data("multiple")&&(d.multiple=!0);this.selectedChanged=new Event("selectedChanged",this);this.fileInput=new o.FileInput(d);this.fileInput.onchange=function(a){c.selectedChanged.fire(c,a.target.files)};this.fileInput.init();return this}});
Inovout.Widgets.DataChart=Class.create(Inovout.View,{initialize:function($super,a){$super(a);var c=(new Function("return "+a.html().replace(/\n/g,"")))();a.empty();$(a.dom).highcharts(c);a.css("visibility","visible")}});
Inovout.Widgets.BinaryPad=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.navs=Inovout.Element.get(document).find(".binaryPad-nav>span");this.articles=a.children("article");var c=this;this.navs.each(function(a){a.click.addListener(function(a,d){c.navs.each(function(a){a.toggle()});c.articles.each(function(a){a.toggle()})})})}});
Inovout.Widgets.Wizard=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.navs=a.find("nav>span");this.articles=a.find("div>article");this.currentArticle=0;var c=this;this.navs[0].click.addListener(function(a,e){c.currentArticle--;c.show(c.currentArticle);c.currentArticle<c.articles.length-1&&c.navs[1].css("visibility","visible");0==c.currentArticle&&c.navs[0].css("visibility","hidden")});this.navs[1].click.addListener(function(a,e){c.currentArticle++;c.show(c.currentArticle);
0<c.currentArticle&&c.navs[0].css("visibility","visible");c.currentArticle==c.articles.length-1&&c.navs[1].css("visibility","hidden")});2<this.navs.length&&this.navs[2].click.addListener(function(a,e){c.currentArticle=c.articles.length-1;c.show(c.currentArticle)})},show:function(b){this.articles.each(function(a){a.hide()});this.articles[b].show()}});
Inovout.Widgets.DataTable=Class.create(Inovout.View,{initialize:function($super,a){$super(a);this.selectedRowsChanged=new Event("selectedRowsChanged",this);this.template=this.element.find(".template")[0];return this},selectRow:function(b){var a=b.parent().parent();this.element.find(".selected").each(function(a){a.removeClass("selected")});a.toggleClass("selected");this.selectedRowsChanged.fire(this,this.wrapEventArgs(b))},insertNewRow:function(b){debugger;b=$.templates("#"+this.template.attr("id")).render(b);
b=new Inovout.Element("<tr>"+b+"</tr>");this.element.append(b);Inovout.HAML.Parser.parse(this.element.find("tr:last")[0])},wrapEventArgs:function(b){b=!1;var a=0;this.element.find(".selected").each(function(b){a++});0<a&&(b=!0);return{hasSelected:b}}});
Inovout.Widgets.Dialog=Class.create(Inovout.View,{initialize:function(b,a,c,d){var e="\u5185\u5bb9\u9875";d&&(e=d);this.widgetDialog=$('<iframe title="'+e+'"  frameborder="0" scrolling="no" style="width:100%;min-width: 95%;height:auto;"   src='+b+"></iframe>").dialog({autoOpen:!0,model:!0,height:c,width:a});return this},messageHandle:function(b){execueDone(b.data)},addEventLister:function(b,a){var c=this.dom;c.addEventListener?c.addEventListener(b,a,!1):c.attachEvent&&c.attachEvent("on"+b,a)},removeEventtLister:function(b,
a){var c=this.dom;if(c.removeEventListener)c.removeEventListener(b,a,!1);else if(c.detachEvent){var d="on"+b;typeof c[d]===core_strundefined&&(c[d]=null);c.detachEvent(d,a)}},done:function(b){this.fnexpression=b},execueDone:function(b){Inovout.View.buildFunction("data",this.fnexpression).call(this,b);this.widgetDialog.dialog("close")},close:function(){this.widgetDialog.dialog("close")},receiveMess:function(b){this.execueDone(b)}});
Inovout.Widgets.DataList=Class.create(Inovout.View,{initialize:function($super,a){$super(a);me=this;me.discriminator=me.element.attr("data-discriminator");me.templates=[];me.element.find(".template").each(function(a){var d=a.attr("data-template_id");a.attr("id",d);me.templates[d]=a});return this},insertNewRow:function(b){b=$.templates("#"+this.templates[b[this.discriminator]].attr("id")).render(b);b=new Inovout.Element("<div class='wgt'>"+b+"</div>");this.element.append(b)}});
Inovout.Widgets.RadioList=Class.create(Inovout.Widgets.List,{initialize:function($super,a){$super(a);this.selectedChanged=new Event("selectedChanged",this);var c=this;a.find("input[type=radio]").each(function(a){a.click.addListener(function(a,d){var f={text:a.value};if(!c.valueKeys){c.valueKeys=[];for(var k=a.getAttributes(),g=0;g<k.length;g++){var h=k[g].name;-1<h.indexOf("data-")&&c.valueKeys.push(h.substring(5,h.length))}}for(g=0;g<c.valueKeys.length;g++)f[c.valueKeys[g]]=a.attr("data-"+c.valueKeys[g]);
f.value=f.value||a.text();c.selectedChanged.fire(c,f)})});return this}});
